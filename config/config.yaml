# Advanced OCR Configuration File

# LLM Provider Settings
llm:
  primary_provider: "qwen"  # openai, anthropic, gemini, or qwen
  fallback_provider: null  # openai, anthropic, gemini, qwen, or null

  openai:
    model: "gpt-4-vision-preview"
    max_tokens: 4096
    temperature: 0.1
    detail: "high"  # low, high, or auto

  anthropic:
    model: "claude-3-sonnet-20240229"  # opus, sonnet, or haiku
    max_tokens: 4096
    temperature: 0.1

  gemini:
    model: "gemini-1.5-flash"  # gemini-1.5-pro or gemini-1.5-flash
    max_tokens: 4096
    temperature: 0.1

  qwen:
    model: "qwen-vl-max"  # ä½¿ç”¨qwen-vl-maxä»¥è·å¾—æ›´å¥½çš„è´¨é‡
    max_tokens: 16384  # è¿›ä¸€æ­¥å¢åŠ ä»¥å¤„ç†å¤æ‚SVG
    temperature: 0.1

  # LLMè¯·æ±‚è¶…æ—¶æ—¶é—´(ç§’)
  request_timeout_seconds: 600

  concurrency:
    enable: true
    max_parallel_requests: 3

  retry:
    max_attempts: 3
    delay_seconds: 2
    backoff_multiplier: 2

# Image Processing Settings
image:
  max_size_mb: 10
  supported_formats:
    - png
    - jpg
    - jpeg
    - pdf
  quality: 90
  base64_format: "jpeg"   # jpeg, png, webp
  base64_quality: 85
  base64_max_bytes: 3145728  # 3MB ä¸Šé™, è¶…è¿‡ä¼šè‡ªåŠ¨å‹ç¼©/ç¼©æ”¾
  preprocessing:
    resize_if_large: true
    max_dimension: 1600
    enhance_contrast: false
    denoise: false
  slicing:
    enable: true
    min_height: 2200
    aspect_ratio_threshold: 2.0
    target_height: 1100
    min_segment_height: 700
    overlap: 160  # å›ºå®šoverlapæ¨¡å¼ä¸‹ä½¿ç”¨ï¼ˆå½“adaptive_overlap.enable=falseæ—¶ï¼‰
    whitespace_window: 150
    whitespace_density_threshold: 0.08
    max_segments: 0  # 0 è¡¨ç¤ºä¸é™åˆ¶åˆ‡ç‰‡æ•°é‡

    # è‡ªé€‚åº”overlapé…ç½®ï¼ˆæ ¹æ®åˆ‡åˆ†ç‚¹è´¨é‡åŠ¨æ€è°ƒæ•´overlapå¤§å°ï¼‰
    adaptive_overlap:
      enable: true  # æ˜¯å¦å¯ç”¨è‡ªé€‚åº”overlap
      excellent_threshold: 0.05  # æä½³åˆ‡åˆ†ç‚¹é˜ˆå€¼ï¼ˆå†…å®¹å¯†åº¦ <= 0.05è§†ä¸ºå®Œå…¨ç©ºç™½ï¼‰
      good_threshold: 0.10       # è‰¯å¥½åˆ‡åˆ†ç‚¹é˜ˆå€¼ï¼ˆå†…å®¹å¯†åº¦ <= 0.10è§†ä¸ºè¾ƒç©ºç™½ï¼‰
      excellent_overlap: 0       # æä½³åˆ‡åˆ†ç‚¹ä½¿ç”¨çš„overlapï¼ˆpxï¼‰
      good_overlap: 30           # è‰¯å¥½åˆ‡åˆ†ç‚¹ä½¿ç”¨çš„overlapï¼ˆpxï¼‰
      default_overlap: 160       # é»˜è®¤overlapï¼ˆåœ¨å†…å®¹åŒºåŸŸåˆ‡åˆ†æ—¶ä½¿ç”¨ï¼‰

    debug:
      save_segments: true
      output_dir: "logs/segments"
      clear_before_save: true
    page_break_detection:
      enable: true
      whiteness_threshold: 0.97
      min_blank_height: 180
      margin_ratio: 0.04

# Formula Conversion Settings
formula:
  output_format: "mathml"  # mathml or latex
  preserve_latex: false  # Keep LaTeX in comments
  inline_formulas: true
  
# Document Generation Settings
document:
  default_font: "Arial"
  default_font_size: 11
  heading_font_size: 14
  include_original_image: true
  image_width_inches: 6.0
  page_margins:
    top: 1.0
    bottom: 1.0
    left: 1.0
    right: 1.0

# Graphics Generation Settings (for 3D geometry, diagrams, etc.)
graphics:
  enabled: true
  backend: "tikz"  # tikz, matplotlib, or svg

  tikz:
    latex_command: "pdflatex"
    convert_dpi: 300
    timeout_seconds: 30

  matplotlib:
    figure_size: [8, 6]
    dpi: 300

  svg:
    validate: true
    convert_to_png: true
  
# Prompt Templates
prompts:
  system_message: |
    You are an expert in accurately transcribing mathematical content from images.
    Always respond in Chinese unless a different language is explicitly requested.
    Faithfully reproduce ALL visible content: text, formulas, labels, and geometry annotations, preserving the original wording and order without adding commentary.

    âš™ï¸ ç»Ÿä¸€è¾“å‡ºæ ¼å¼
    - ä½ å¿…é¡»åªè¾“å‡ºä¸€ä¸ªåˆæ³•çš„ JSON å¯¹è±¡ï¼š{"text": "...", "figure_svg": "..."}
    - ä¸è¦æ·»åŠ  Markdownã€é¢å¤–è¯´æ˜ã€ä»£ç å—æˆ–å¤šä½™é”®ã€‚
    - JSON å­—ç¬¦ä¸²ä¸­çš„åŒå¼•å·å¿…é¡»å†™æˆ \"ï¼Œæ¢è¡Œå†™æˆ \nï¼Œç¡®ä¿æ•´ä½“å¯è§£æã€‚

    ğŸ“„ â€œtextâ€ å­—æ®µè¦æ±‚
    - å®Œæ•´è½¬å½•å›¾ç‰‡ä¸­çš„æ–‡å­—å†…å®¹ï¼Œä¿æŒåŸæœ‰æ®µè½å’Œæ ‡ç‚¹ã€‚
    - è¡Œå†…å…¬å¼ç”¨ $...$ï¼Œç‹¬ç«‹å…¬å¼ç”¨ $$...$$ã€‚
    - æ‰€æœ‰æ•°å­¦ç¬¦å·è½¬æ¢ä¸ºå¯¹åº”çš„ LaTeX å‘½ä»¤ï¼ˆè§ä¸‹æ–¹åˆ—è¡¨ï¼‰ï¼Œä¸¥ç¦ä½¿ç”¨ Unicode æ•°å­¦å­—ç¬¦ã€‚
    - è‹¥å›¾ç‰‡åŒ…å«å‡ ä½•é¢˜ï¼Œéœ€åœ¨æ–‡å­—æè¿°ä¸­æ¸…æ¥šè¯´æ˜å›¾å½¢ä¿¡æ¯ï¼Œä¸ SVG æ ‡æ³¨ä¸€è‡´ã€‚

    ğŸ–¼ï¸ â€œfigure_svgâ€ å­—æ®µè¦æ±‚
    - å½“å›¾ç‰‡å«æœ‰å‡ ä½•å›¾ï¼ˆå¹³é¢æˆ–ç«‹ä½“ï¼‰æ—¶ï¼Œæä¾›ä¸ä¹‹åŒ¹é…çš„å®Œæ•´ SVG ä»£ç å­—ç¬¦ä¸²ï¼›è‹¥æ²¡æœ‰å›¾å½¢ï¼Œè®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸² ""ã€‚
    - å¿…é¡»åŒ…å«åˆé€‚çš„ viewBoxï¼ˆä¾‹å¦‚ viewBox="0 0 200 200"ï¼‰ã€‚
    - ä»…ä½¿ç”¨åŸºç¡€å…ƒç´ ï¼ˆ<path>ã€<line>ã€<circle>ã€<text> ç­‰ï¼‰ï¼Œå¹¶ä¿æŒ SVG ç²¾ç®€ã€‚
    - å¯è§æ£±ï¼šstroke="black"ã€stroke-width="1" çš„å®çº¿ï¼›ä¸å¯è§æ£±ï¼šåŒè‰²ç»†åº¦ä½†å¸¦ stroke-dasharray="4 3"ã€‚
    - åœ¨æ‰€æœ‰å…³é”®é¡¶ç‚¹é™„è¿‘ä½¿ç”¨ <text>ï¼ˆfont-size çº¦ 10pxï¼‰æ ‡æ³¨å¤§å†™å­—æ¯ï¼Œå¦‚ Aã€Bã€Cã€Pã€Qï¼Œä½ç½®åº”ä¸æ–‡å­—æè¿°ä¸€è‡´ã€‚
    - é»˜è®¤å¡«å……ä¸ºç©ºï¼ˆfill="none" æˆ–çœç•¥ï¼‰ï¼Œé™¤ééœ€è¦ç‰¹æ®Šå¼ºè°ƒã€‚
    - SVG ä»£ç å¿…é¡»ä¸é¢˜é¢ä¸€è‡´ï¼Œä¸å¾—ä½¿ç”¨å ä½ç¬¦æˆ–ä¸æ–‡å­—ä¸ç¬¦çš„å›¾å½¢ã€‚

    âœ… å¿…é¡»ä½¿ç”¨çš„ LaTeX å‘½ä»¤
    - æ±‚å’Œï¼š\sum_{i=1}^{N}
    - è¿ä¹˜ï¼š\prod_{i=1}^{n}
    - ç§¯åˆ†ï¼š\int_{a}^{b}
    - å¹³å‡/ä¸Šåˆ’çº¿ï¼š\bar{X}, \overline{XYZ}
    - åˆ†æ•°ï¼š\frac{a}{b}
    - æ ¹å·ï¼š\sqrt{expression}
    - æ— ç©·ï¼š\infty
    - å¸Œè…Šå­—æ¯ï¼š\alpha, \beta, \gamma, \delta, \theta, \lambda, \mu, \pi, \sigma, \phi, \omega
    - å…³ç³»ç¬¦å·ï¼š\approx, \neq, \leq, \geq, \in, \subset, \cup, \cap
    - è¿ç®—ç¬¦ï¼š\times, \div, \pm, \cdot
    - ç®­å¤´ï¼š\rightarrow, \leftarrow, \Rightarrow, \Leftrightarrow
    - é€»è¾‘ï¼š\forall, \exists, \wedge, \vee, \neg
    - çŸ©é˜µï¼š\begin{pmatrix}...\end{pmatrix}, \begin{bmatrix}...\end{bmatrix}, \begin{vmatrix}...\end{vmatrix}

    âŒ ç¦æ­¢å‡ºç°çš„ Unicode æ•°å­¦å­—ç¬¦
    - Î£, âˆ‘, Î , âˆ, âˆ«, âˆš, âˆ ç­‰ï¼›è¯·ä½¿ç”¨å¯¹åº” LaTeXã€‚
    - Î±, Î², Î³, Î´, Î¸, Î», Î¼, Ï€, Ïƒ, Ï†, Ï‰ ç­‰ï¼›è¯·ä½¿ç”¨ \alpha ç­‰å†™æ³•ã€‚
    - â‰ˆ, â‰ , â‰¤, â‰¥, âˆˆ, âŠ‚, âˆª, âˆ© ç­‰ï¼›è¯·ä½¿ç”¨ \approx ç­‰å†™æ³•ã€‚
    - Ã—, Ã·, Â±, â‹… ç­‰ï¼›è¯·ä½¿ç”¨ \times ç­‰å†™æ³•ã€‚
    - ç»„åˆç¬¦å·å¦‚ È²ã€xÌ„ ç­‰ï¼›è¯·ä½¿ç”¨ \bar{Y}ã€\bar{x}ã€‚
    - å½¢å¼å¦‚ (a+b)/cï¼›è¯·ä½¿ç”¨ \frac{a+b}{c}ã€‚

    ğŸ§¾ ç¤ºä¾‹ï¼ˆä»…ä¾›ç†è§£ï¼Œä¸è¦æŠ„å†™ï¼‰
    - è‹¥å›¾ç‰‡å±•ç¤ºå…¬å¼â€œå¹³å‡å€¼ È² = (1/N)Î£Yáµ¢â€ï¼š
      {"text": "å¹³å‡å€¼ $$\\bar{Y} = \\frac{1}{N}\\sum_{i=1}^{N} Y_i$$", "figure_svg": ""}
    - è‹¥å›¾ç‰‡å«æœ‰ç«‹ä½“å‡ ä½•å›¾ï¼Œéœ€åœ¨ "text" æè¿°æ‰€æœ‰æ¡ä»¶ï¼Œå¹¶åœ¨ "figure_svg" ä¸­ç»™å‡ºåŒ¹é…çš„ SVGã€‚

    å§‹ç»ˆä¿æŒ JSON åˆæ³•ã€æ–‡æœ¬ä¸ SVG å¯¹é½ã€‚

  user_message: |
    è¯·æ ¹æ®æä¾›çš„å›¾ç‰‡å†…å®¹å®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼Œå¹¶ä¸¥æ ¼æŒ‰è¦æ±‚ä½œç­”ï¼š

    1. åªè¾“å‡ºä¸€ä¸ª JSON å¯¹è±¡ï¼š{"text": "...", "figure_svg": "..."}ï¼Œä¸è¦æ·»åŠ å…¶å®ƒæ–‡å­—æˆ–ä»£ç å—ã€‚
    2. "text" å†…å®Œæ•´è½¬å½•å›¾ç‰‡æ–‡å­—ï¼Œä¿ç•™åŸæ®µè½ï¼›å…¬å¼ä½¿ç”¨ $...$ æˆ– $$...$$ï¼Œå¹¶å…¨éƒ¨è½¬æ¢ä¸ºæ ‡å‡† LaTeX å‘½ä»¤ã€‚
    3. å¦‚æœå›¾ç‰‡å‡ºç°å‡ ä½•å›¾å½¢ï¼Œ"figure_svg" å¿…é¡»ç»™å‡ºåŒ¹é…çš„ SVG ä»£ç å­—ç¬¦ä¸²ï¼šå« viewBoxï¼Œä½¿ç”¨ <path>/<line>/<circle>/<text> ç­‰å…ƒç´ ï¼›å¯è§æ£±ä¸ºé»‘è‰² 1px å®çº¿ï¼Œéšè—æ£±ä½¿ç”¨ stroke-dasharray="4 3"ï¼›åœ¨é¡¶ç‚¹æ—æ ‡æ³¨å¤§å†™å­—æ¯ï¼ˆå­—ä½“çº¦ 10pxï¼‰ã€‚
    4. å¦‚æœæ²¡æœ‰å‡ ä½•å›¾å½¢ï¼Œåˆ™å°† "figure_svg" è®¾ä¸º ""ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰ã€‚
    5. SVG å­—ç¬¦ä¸²å†…çš„åŒå¼•å·å†™æˆ \"ï¼Œæ¢è¡Œå†™æˆ \nï¼Œä¿è¯ JSON å¯è§£æã€‚
    6. ç¦æ­¢ä½¿ç”¨ Unicode æ•°å­¦ç¬¦å·ï¼Œå…¨éƒ¨æ”¹å†™ä¸º LaTeX å‘½ä»¤ï¼ˆä¾‹å¦‚ \sumã€\alphaã€\sqrt ç­‰ï¼‰ã€‚
    7. ä¸å¾—ä½¿ç”¨å ä½ç¬¦æˆ–ä¸é¢˜æ„ä¸ç¬¦çš„å†…å®¹ï¼Œé¡»ç¡®ä¿æ–‡å­—ä¸ SVG å®Œå…¨ä¸€è‡´ã€‚



  geometry_svg_system: |
    You are an expert math problem setter and SVG illustrator. Your job is to generate challenging three-dimensional geometry problems and provide a matching SVG diagram that satisfies strict formatting constraints.

    OUTPUT FORMAT (MANDATORY):
    - Respond with exactly one valid JSON object that contains two keys: "text" and "figure_svg".
    - Do not output Markdown, comments, additional prose, or multiple JSON objects.
    - The "text" field must be a Chinese description of the 3D geometry problem, including all necessary numerical data and the final question.
    - The "figure_svg" field must be a single-line string that contains complete SVG code. Escape double quotes as \" and encode line breaks as \n.

    SVG REQUIREMENTS:
    - Include a suitable viewBox attribute such as viewBox="0 0 200 200".
    - Use fundamental SVG elements like <path>, <line>, <circle>, and <text> to depict the solid.
    - Draw visible edges with solid black lines (stroke="black", stroke-width="1"), and hidden edges with dashed lines using stroke-dasharray="4 3".
    - Label every relevant vertex directly beside the point using <text> elements (font-size about 10px) with uppercase letters such as A, B, C, P, Q.
    - Ensure all strokes are black with stroke-width="1" and fills are transparent unless a solid face must be highlighted.
    - Produce accurate geometry; do not return placeholders or approximate sketches unrelated to the described solid.

    GENERAL RULES:
    - The JSON must be syntactically valid and directly parsable.
    - Keep the SVG concise but complete, ensuring all elements referenced in the text appear in the diagram.
    - If you cannot satisfy the requirements, explain the issue succinctly inside the "text" value while still outputting valid JSON.

  geometry_svg_user: |
    è¯·ç”Ÿæˆä¸€é“å…³äºç«‹ä½“å‡ ä½•ï¼ˆå¦‚æ£±é”¥ã€æ£±æŸ±ç­‰ï¼‰çš„é¢˜ç›®ï¼Œå¹¶æŒ‰ç…§ä»¥ä¸‹è¦æ±‚è¿”å› JSONï¼š
    1. ä»…è¾“å‡ºå½¢å¦‚ {"text": "...", "figure_svg": "..."} çš„åˆæ³• JSONï¼›ä¸å¾—åŒ…å«å…¶ä»–è¯´æ˜æˆ–å¤šä½™æ–‡æœ¬ã€‚
    2. "text" å­—æ®µå†™å‡ºä¸­æ–‡é¢˜ç›®ï¼Œç»™å‡ºå…¨éƒ¨å·²çŸ¥æ¡ä»¶å’Œæ±‚è§£ç›®æ ‡ã€‚
    3. "figure_svg" å­—æ®µå†™å‡ºå®Œæ•´ SVG ä»£ç å­—ç¬¦ä¸²ï¼šå¿…é¡»åŒ…å« viewBoxï¼Œä½¿ç”¨ <path>/<line>/<circle>/<text> ç­‰å…ƒç´ ï¼›å¯è§æ£±ç”¨å®çº¿ï¼Œä¸å¯è§æ£±ç”¨ stroke-dasharray="4 3" çš„è™šçº¿ï¼›åœ¨å„é¡¶ç‚¹é™„è¿‘æ ‡æ³¨ Aã€Bã€Cã€Pã€Q ç­‰å­—æ¯ï¼ˆå­—ä½“çº¦ 10pxï¼‰ï¼›æ‰€æœ‰çº¿æ¡ä¸ºé»‘è‰²ã€ç²—ç»† 1ã€‚
    4. SVG ä¸­çš„åŒå¼•å·éœ€è½¬ä¹‰ä¸º \"ï¼Œæ¢è¡Œå†™æˆ \nï¼Œç¡®ä¿æ•´æ®µ SVG æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚
    5. ä¸å¾—è¿”å›å ä½ç¬¦æˆ–ç©ºå†…å®¹ï¼Œé¢˜ç›®ä¸å›¾å½¢éœ€ç›¸äº’å¯¹åº”ä¸”ä¸¥è°¨ã€‚


# Logging Settings
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR, CRITICAL
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file_rotation: true
  max_bytes: 10485760  # 10MB
  backup_count: 5
  console_output: true
  
# Output Settings
output:
  directory: "output"
  filename_pattern: "math_problem_{timestamp}.docx"
  save_intermediate: false  # Save LaTeX and other intermediate files
  
# Performance Settings
performance:
  parallel_processing: false
  cache_api_responses: false
  cache_ttl_hours: 24
