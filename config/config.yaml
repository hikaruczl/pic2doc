# Advanced OCR Configuration File

# LLM Provider Settings
llm:
  primary_provider: "gemini"  # openai, anthropic, gemini, or qwen
  fallback_provider: "qwen"  # openai, anthropic, gemini, qwen, or null

  openai:
    model: "gpt-4-vision-preview"
    max_tokens: 4096
    temperature: 0.1
    detail: "high"  # low, high, or auto

  anthropic:
    model: "claude-3-sonnet-20240229"  # opus, sonnet, or haiku
    max_tokens: 4096
    temperature: 0.1

  gemini:
    model: "gemini-1.5-flash"  # gemini-1.5-pro or gemini-1.5-flash
    max_tokens: 4096
    temperature: 0.1

  qwen:
    model: "qwen3-vl-plus"  # qwen3-vl-plus or qwen3-vl-max
    max_tokens: 4096
    temperature: 0.1

  # LLM请求超时时间(秒)
  request_timeout_seconds: 600

  concurrency:
    enable: true
    max_parallel_requests: 3

  retry:
    max_attempts: 3
    delay_seconds: 2
    backoff_multiplier: 2

# Image Processing Settings
image:
  max_size_mb: 10
  supported_formats:
    - png
    - jpg
    - jpeg
    - pdf
  quality: 90
  base64_format: "jpeg"   # jpeg, png, webp
  base64_quality: 85
  base64_max_bytes: 3145728  # 3MB 上限, 超过会自动压缩/缩放
  preprocessing:
    resize_if_large: true
    max_dimension: 1600
    enhance_contrast: false
    denoise: false
  slicing:
    enable: true
    min_height: 2200
    aspect_ratio_threshold: 2.0
    target_height: 1100
    min_segment_height: 700
    overlap: 160  # 固定overlap模式下使用（当adaptive_overlap.enable=false时）
    whitespace_window: 150
    whitespace_density_threshold: 0.08
    max_segments: 0  # 0 表示不限制切片数量

    # 自适应overlap配置（根据切分点质量动态调整overlap大小）
    adaptive_overlap:
      enable: true  # 是否启用自适应overlap
      excellent_threshold: 0.05  # 极佳切分点阈值（内容密度 <= 0.05视为完全空白）
      good_threshold: 0.10       # 良好切分点阈值（内容密度 <= 0.10视为较空白）
      excellent_overlap: 0       # 极佳切分点使用的overlap（px）
      good_overlap: 30           # 良好切分点使用的overlap（px）
      default_overlap: 160       # 默认overlap（在内容区域切分时使用）

    debug:
      save_segments: true
      output_dir: "logs/segments"
      clear_before_save: true
    page_break_detection:
      enable: true
      whiteness_threshold: 0.97
      min_blank_height: 180
      margin_ratio: 0.04

# Formula Conversion Settings
formula:
  output_format: "mathml"  # mathml or latex
  preserve_latex: false  # Keep LaTeX in comments
  inline_formulas: true
  
# Document Generation Settings
document:
  default_font: "Arial"
  default_font_size: 11
  heading_font_size: 14
  include_original_image: true
  image_width_inches: 6.0
  page_margins:
    top: 1.0
    bottom: 1.0
    left: 1.0
    right: 1.0
  
# Prompt Templates
prompts:
  system_message: |
    You are an expert in accurately transcribing mathematical content from images.
    Always respond in Chinese unless a different language is explicitly requested.
    Your task is to faithfully reproduce ALL content from the image exactly as it appears.
    Preserve the original layout, order, and formatting of the text and formulas.
    For formulas: use $...$ for inline expressions and $$...$$ for display equations.
    Do not add any section headings, explanations, or additional commentary.
    Do not reorganize or restructure the content.
    Simply transcribe what you see in the image, maintaining the original presentation.
  user_message: |
    请完整还原这张图片中的所有内容，保持原有格式和顺序。
    
    要求：
    - 逐字逐句转录图片中的所有文字
    - 公式按原位置输出：行内公式用 $公式$，单独成行的公式用 $$公式$$
    - 不要添加任何章节标题、分类或额外说明
    - 不要重新组织或调整内容结构
    - 保持图片中原有的段落分隔和排版

# Logging Settings
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR, CRITICAL
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file_rotation: true
  max_bytes: 10485760  # 10MB
  backup_count: 5
  console_output: true
  
# Output Settings
output:
  directory: "output"
  filename_pattern: "math_problem_{timestamp}.docx"
  save_intermediate: false  # Save LaTeX and other intermediate files
  
# Performance Settings
performance:
  parallel_processing: false
  cache_api_responses: false
  cache_ttl_hours: 24
