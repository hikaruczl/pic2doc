# 🚀 本地启动脚本（仅前后端）

## 功能说明

`start_local.sh` - 只启动前后端服务，**不需要 PostgreSQL 和 Redis**

适用场景：
- ✅ 测试 OCR 功能（公式识别、文档生成）
- ✅ 开发调试（前端 + 后端 API）
- ✅ 快速验证代码修复
- ❌ 用户认证功能不可用（需要数据库）

---

## 🎯 使用方法

### 启动服务
```bash
cd /mnt/vdb/dev/advanceOCR
./start_local.sh
```

### 停止服务
```bash
./stop_local.sh
```

---

## 📊 访问地址

启动后可访问：

- **前端界面**: http://localhost:5173
- **后端 API**: http://localhost:8005

---

## 🧪 测试 OCR 功能

1. 打开浏览器访问: http://localhost:5173
2. 上传包含数学公式的图片
3. 等待识别完成
4. 下载生成的 Word 文档
5. 检查修复效果：
   - ✅ `ar{x}1` → x̄₁
   - ✅ `y_02` → y₀²
   - ✅ `x_02` → x₀²
   - ✅ 矩阵括号正确

---

## 📝 查看日志

```bash
# 后端日志（实时）
tail -f logs/backend.log

# 前端日志（实时）
tail -f logs/frontend.log

# 查看最近日志
tail -50 logs/backend.log
tail -50 logs/frontend.log
```

---

## 🔧 原理说明

### 自动处理的问题

1. **清除代理设置**
   - 自动清除 http/https/socks 代理环境变量
   - 解决 httpx 不支持 socks 代理的问题

2. **跳过数据库初始化**
   - 设置 `SKIP_DB_INIT=true` 环境变量
   - 后端跳过 PostgreSQL 和 Redis 连接
   - OCR 核心功能正常工作

3. **权限问题**
   - 自动使用当前用户权限
   - 日志文件写入无权限问题

---

## ⚠️ 注意事项

### 功能限制

无数据库模式下，以下功能**不可用**：
- ❌ 用户注册/登录
- ❌ 用户认证
- ❌ 历史记录
- ❌ 批量任务管理

但核心 OCR 功能**完全正常**：
- ✅ 图片上传
- ✅ 公式识别
- ✅ Word 文档生成
- ✅ OCR 错误修复
- ✅ 矩阵括号修复
- ✅ TikZ 图形渲染

### 认证接口

如果前端调用认证相关接口会失败，但不影响 OCR 功能使用。

---

## 🆚 其他启动方式对比

| 启动方式 | 命令 | 数据库 | Redis | 用户认证 | 适用场景 |
|---------|------|--------|-------|---------|---------|
| **本地模式** | `./start_local.sh` | ❌ | ❌ | ❌ | 快速测试 OCR |
| **完整模式** | `./start_all.sh` | ✅ | ✅ | ✅ | 开发/测试 |
| **Docker模式** | `./start_docker.sh` | ✅ | ✅ | ✅ | 生产部署 |

---

## 🐛 故障排查

### 后端启动失败

**查看日志**:
```bash
tail -50 logs/backend.log
```

**常见问题**:

1. **端口被占用**
   ```bash
   lsof -i :8005
   # 如果被占用，杀掉进程
   pkill -f "python.*app.py"
   ```

2. **依赖缺失**
   ```bash
   uv pip install -r requirements.txt
   ```

3. **代理问题**
   - 脚本会自动清除代理
   - 如果仍有问题，手动运行：
   ```bash
   unset http_proxy https_proxy HTTP_PROXY HTTPS_PROXY all_proxy ALL_PROXY
   ./start_local.sh
   ```

### 前端启动失败

**查看日志**:
```bash
tail -50 logs/frontend.log
```

**常见问题**:

1. **端口被占用**
   ```bash
   lsof -i :5173
   # 如果被占用，杀掉进程
   pkill -f "vite"
   ```

2. **依赖缺失**
   ```bash
   cd web/frontend
   npm install
   ```

### 手动启动

如果脚本有问题，可以手动启动：

```bash
# 1. 后端
cd /mnt/vdb/dev/advanceOCR
unset http_proxy https_proxy HTTP_PROXY HTTPS_PROXY all_proxy ALL_PROXY
export SKIP_DB_INIT=true
uv run python web/backend/app.py

# 2. 前端（新终端）
cd /mnt/vdb/dev/advanceOCR/web/frontend
npm run dev
```

---

## 📋 完整启动流程

```bash
cd /mnt/vdb/dev/advanceOCR

# 1. 启动服务
./start_local.sh

# 2. 等待启动（约 5 秒）
sleep 5

# 3. 测试后端
curl http://localhost:8005/

# 4. 打开前端
# 浏览器访问: http://localhost:5173

# 5. 测试 OCR 功能
# 上传图片，检查生成的文档

# 6. 查看日志（如需要）
tail -f logs/backend.log

# 7. 停止服务（完成后）
./stop_local.sh
```

---

**创建时间**: 2025-10-13
**最后更新**: 2025-10-13
**维护者**: Advanced OCR Team
